/* cheevs by Adam Scoble - https://github.com/adamscoble/cheevs - adam.scoble@gmail.com */
(function(a){"use strict";function b(){this.$window=a(window),this.windowHeight=this._getWindowHeight(),this.$body=a("body"),this.bodyWidth=this._getBodyWidth(),this._createDOMElement(),this.$elem=a("#cheevs"),this.type={xbox:new b.Xbox(this)},this.achievements=[],this.isActive=!1,this._init()}b.prototype={_createDOMElement:function(){this.$body.append('<div id="cheevs"></div>')},_getWindowHeight:function(){return this.$window.height()},_getBodyWidth:function(){return this.$body.outerWidth(!1)},_init:function(){this._addEventListeners()},_addEventListeners:function(){var a=this;a.$window.bind("unlockAchievement",jQuery.proxy(a.unlock,a)).bind("achievementComplete",jQuery.proxy(a._achievementComplete,a)).resize(function(){a.windowHeight=a._getWindowHeight(),a.bodyWidth=a._getBodyWidth()})},unlock:function(){if(!this.isActive){this.isActive=!0;var a=this._getAchievement(0);return this.type[a.type]._unlock(a),this}},_getAchievement:function(a){var b=this.achievements[a];return this.achievements.splice(0,1),b},_achievementComplete:function(){this.isActive=!1,this.achievements.length&&this.unlock()},add:function(a){var b=this;return a===void 0?(console.error("Please define an achievement object"),b):(jQuery.isArray(a)?jQuery.each(a,function(a,c){b._createAchievement(c)}):b._createAchievement(a),b.$window.trigger("unlockAchievement"),b)},_createAchievement:function(a){var c=new b.Achievement(a);this.achievements.push(c)},changeDirectory:function(a){this.type.xbox._changeDirectory(a)}},b.Achievement=function(b){var c={type:"xbox",position:"center",heading:null,achievement:""},d=a.extend({},c,b||{});return this.type=d.type,this.position=d.position,this.heading=d.heading,this.achievement=d.achievement,this},b.Xbox=function(b){return this.cheevs=b,this._createDOMElement(),this.elems={},this._findElements(),this.isLtIE9=!a.support.leadingWhitespace,this.audioReady=!1,this.imagesReady=!1,this.imagesLoaded=0,this._addEventListeners(),this.staticWidth=this._getStaticWidth(),this.targetWidth=0,this.currentHeight=100,this.position="center",this.maxWidth=this._getMaxWidth(),this},b.Xbox.prototype={defaults:{heading:"ACHIEVEMENT UNLOCKED"},_createDOMElement:function(){this.cheevs.$elem.append('<div id="cheevs-xbox" style="height: 100px; position: fixed; display: none;"><img src="cheevs/img/cheevs-icon_xbox-trophy.png" id="cheevs-xbox-trophy" style="width: auto; height: 100px; float: left;" /><img src="cheevs/img/cheevs-icon_xbox-logo.png" id="cheevs-xbox-logo" style="width: auto; height: 100px; position: absolute; left: 0px; top: 0px;" /><div id="cheevs-xbox-text" style="height: 100px; background: #3b3f40; overflow: hidden; float: left;"><p id="cheevs-xbox-heading" style="font-family: \'convectionregular\', Arial, sans-serif; font-size: 30px; margin: 12px 10px 0px; color: #fff; width: 100%; white-space: nowrap;">ACHIEVEMENT UNLOCKED</p><p id="cheevs-xbox-achievement" style="font-family: \'convectionregular\', Arial, sans-serif; font-size: 30px; margin: 0px 10px 0px; color: #fff; width: 100%; white-space: nowrap;">ACHIEVEMENT UNLOCKED</p></div><img src="cheevs/img/cheevs-icon_xbox-end.png" id="cheevs-xbox-end" style="width: auto; height: 100px; float: left;" /><audio id="cheevs-xbox-sound"><source id="cheevs-xbox-sound" src="cheevs/sounds/cheevs-sound_xbox.mp3"><source id="cheevs-xbox-sound-ogg" src="cheevs/sounds/cheevs-sound_xbox.ogg"></source></audio></div>')},_findElements:function(){var a=this.cheevs.$elem;this.elems={$elem:a.find("#cheevs-xbox"),$trophy:a.find("#cheevs-xbox-trophy"),$logo:a.find("#cheevs-xbox-logo"),$text:a.find("#cheevs-xbox-text"),$heading:a.find("#cheevs-xbox-heading"),$achievement:a.find("#cheevs-xbox-achievement"),$end:a.find("#cheevs-xbox-end"),$sound:a.find("#cheevs-xbox-sound")},this.elems.$resizeElems=this.elems.$trophy.add(this.elems.$logo).add(this.elems.$text).add(this.elems.$end)},_addEventListeners:function(){var a=this;this.isLtIE9?a.audioReady=!0:a.elems.$sound.bind("canplaythrough",function(){a.audioReady=!0});var b=a.elems.$trophy.add(a.elems.$logo).add(a.elems.$end);b.load(jQuery.proxy(a._imageLoadedHandler,a)),a.cheevs.$window.resize(function(){a.staticWidth=a._getStaticWidth(),a.maxWidth=a._getMaxWidth(),a._resizeElem(),a._positionElem()})},_imageLoadedHandler:function(){this.imagesLoaded++,3==this.imagesLoaded&&(this.imagesReady=!0)},_getStaticWidth:function(){return 1.5*this.elems.$logo.outerHeight()},_getMaxWidth:function(){return this.cheevs.bodyWidth-this.staticWidth},_unlock:function(a){this._isMediaLoaded(a)&&(this._resetValues(),!this.isLtIE9&&this.elems.$sound[0].play(),this._updateAchievementMarkup(a),this.elems.$elem.show(),this._resizeElem(),this.elems.$elem.hide(),this.elems.$text.width(0),this.position=a.position,this._positionElem(),this._animateIn(this.targetWidth))},_isMediaLoaded:function(a){if(!this.imagesReady||!this.audioReady){var b=this;return setTimeout(function(){b._unlock(a)},500),!1}return!0},_resetValues:function(){this.elems.$elem.width("auto"),this.elems.$heading.css({"font-size":30,"margin-top":"12px"}),this.elems.$achievement.css({"font-size":30,"margin-top":0}),this.elems.$resizeElems.height(100),this.staticWidth=this._getStaticWidth()},_updateAchievementMarkup:function(a){a.heading?this.elems.$heading.html(a.heading):this.elems.$heading.html(this.defaults.heading),this.elems.$achievement.html(a.achievement)},_resizeElem:function(){var a=this.elems.$text.width("auto").outerWidth();a>this.maxWidth&&(a=this._resizeFont()),this.targetWidth=a,this.elems.$elem.width(this.staticWidth+a)},_resizeFont:function(){var a=parseInt(this.elems.$heading.css("font-size"));this.elems.$heading.css({"font-size":a-1,"margin-top":.15*this.elems.$text.height()}),this.elems.$achievement.css({"font-size":a-1,"margin-top":.09*this.elems.$text.height()});var b=2*(this.elems.$heading.height()+this.elems.$achievement.height());this.elems.$resizeElems.height(b),this.currentHeight=b;var c=this.elems.$text.outerWidth();return this.staticWidth=this._getStaticWidth(),this.maxWidth=this._getMaxWidth(),c>this.maxWidth&&(c=this._resizeFont()),c},_positionElem:function(){var a=0;switch(this.position){case"top":a=this.currentHeight/2;break;case"center":a=this.cheevs.windowHeight/2-this.currentHeight/2;break;case"bottom":a=this.cheevs.windowHeight-this.currentHeight-this.currentHeight/2}this.elems.$elem.css({top:a,left:this.cheevs.bodyWidth/2-(this.staticWidth+this.targetWidth)/2})},_animateIn:function(a){jQuery.when(this.elems.$elem.stop().fadeIn(400),this.elems.$text.stop().animate({width:a},400)).done(jQuery.proxy(this._animateLogo,this))},_animateLogo:function(){this.elems.$logo.delay(1e3).fadeOut(600).delay(1e3).fadeIn(600).delay(1e3).fadeOut(600).delay(1e3).fadeIn(600,jQuery.proxy(this._animateOut,this))},_animateOut:function(){jQuery.when(this.elems.$elem.fadeOut(400),this.elems.$text.animate({width:0},400)).done(jQuery.proxy(this._triggerAnimationComplete,this))},_triggerAnimationComplete:function(){this.cheevs.$window.trigger("achievementComplete")},_changeDirectory:function(a){var b=[this.elems.$trophy,this.elems.$logo,this.elems.$end,this.elems.$sound.find("#cheevs-xbox-sound"),this.elems.$sound.find("#cheevs-xbox-sound-ogg")];this._updateSrcMarkup(b,a)},_updateSrcMarkup:function(a,b){jQuery.each(a,function(a,c){var d=b+c.attr("src").substring(c.attr("src").indexOf("/")+1);c.attr("src",d)})}},window.cheevs=new b})(jQuery);